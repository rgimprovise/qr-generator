# üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∞–Ω–∞–ª–∏–∑—É –ª–æ–≥–æ–≤

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–°–∫—Ä–∏–ø—Ç `analyze-logs.js` –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è:
- –ü–æ–¥—Å—á–µ—Ç–∞ –≤—Å–µ—Ö —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –∏–∑ –ª–æ–≥–æ–≤
- –ü–æ–∏—Å–∫–∞ –æ—à–∏–±–æ–∫ –ë–î –∏ –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–±–ª–µ–º
- –°—Ä–∞–≤–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ª–æ–≥–æ–≤ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- –í—ã—è–≤–ª–µ–Ω–∏—è —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π –∏ –Ω–µ–¥–æ—É—á–µ—Ç–æ–≤

---

## üìÇ –ì–¥–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –ª–æ–≥–∏?

### 1. PM2 –ª–æ–≥–∏ (–æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫)

PM2 –ª–æ–≥–∏ –æ–±—ã—á–Ω–æ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤:
- `./logs/` (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
- `~/.pm2/logs/` (–≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ PM2)

**–ï—Å–ª–∏ –ª–æ–≥–∏ –Ω–µ –≤ —Ñ–∞–π–ª–∞—Ö, —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∏—Ö:**

```bash
# –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –ª–æ–≥–æ–≤ PM2 –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
pm2 logs qr-generator --lines 100000 --nostream > /var/www/qr-generator/logs/pm2-export.log

# –ò–ª–∏ —Ç–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
pm2 logs qr-generator --err --lines 100000 --nostream > /var/www/qr-generator/logs/pm2-err.log

# –ò–ª–∏ —Ç–æ–ª—å–∫–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—ã–≤–æ–¥
pm2 logs qr-generator --out --lines 100000 --nostream > /var/www/qr-generator/logs/pm2-out.log
```

### 2. Nginx access logs

–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Nginx –∫–∞–∫ reverse proxy:

```bash
# –û—Å–Ω–æ–≤–Ω–æ–π access log
/var/log/nginx/access.log

# –ò–ª–∏ site-specific
/var/log/nginx/your-domain-access.log
```

### 3. Caddy logs

–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Caddy:

```bash
/var/log/caddy/access.log
```

### 4. Systemd logs

–ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ —á–µ—Ä–µ–∑ systemd:

```bash
# –≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤ systemd
journalctl -u qr-generator --since "2024-01-01" > /var/www/qr-generator/logs/systemd-export.log
```

---

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```bash
cd /var/www/qr-generator
node analyze-logs.js
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–π–¥–µ—Ç –ª–æ–≥–∏ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö.

### –£–∫–∞–∑–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

```bash
node analyze-logs.js --log-dir=/var/log/nginx
```

### –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ñ–∞–π–ª–∞

```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫—É—é —Å—Å—ã–ª–∫—É –∏–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª –≤ logs/
cp /var/log/nginx/access.log /var/www/qr-generator/logs/nginx-access.log
node analyze-logs.js
```

---

## üìä –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç?

### 1. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑ –ª–æ–≥–æ–≤
- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
- –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ QR-–∫–æ–¥–∞–º
- –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ –¥–∞—Ç–∞–º
- –ü–µ—Ä–∏–æ–¥ –ø–æ–∫—Ä—ã—Ç–∏—è –ª–æ–≥–æ–≤

### 2. –û—à–∏–±–∫–∏
- –í—Å–µ–≥–æ –æ—à–∏–±–æ–∫
- –û—à–∏–±–∫–∏ –ë–î (INSERT, UPDATE)
- –û—à–∏–±–∫–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞
- –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 –æ—à–∏–±–æ–∫ —Å –¥–µ—Ç–∞–ª—è–º–∏

### 3. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ë–î
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –∏–∑ –ª–æ–≥–æ–≤ —Å `total_scans` –≤ –ë–î
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∑–∞–ø–∏—Å–µ–π –≤ —Ç–∞–±–ª–∏—Ü–µ `scans`
- –î–µ—Ç–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ –∫–∞–∂–¥–æ–º—É QR-–∫–æ–¥—É
- –í—ã—è–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### Express –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

–ï—Å–ª–∏ –≤ –ª–æ–≥–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ (GET /r/...), —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ. Express –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã.

**–†–µ—à–µ–Ω–∏—è:**

1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ (Nginx/Caddy)** - –æ–Ω–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –≤—Å–µ HTTP –∑–∞–ø—Ä–æ—Å—ã
2. **–î–æ–±–∞–≤–∏—Ç—å middleware –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è** (—Å–º. –Ω–∏–∂–µ)

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ Express

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏, –¥–æ–±–∞–≤—å—Ç–µ –≤ `server.js`:

```javascript
// –ü–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 18 (app.use(express.static('public'));)
const morgan = require('morgan');
const fs = require('fs');
const path = require('path');

// –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –ª–æ–≥–æ–≤, –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
const logsDir = path.join(__dirname, 'logs');
if (!fs.existsSync(logsDir)) {
  fs.mkdirSync(logsDir, { recursive: true });
}

// –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ñ–∞–π–ª
const accessLogStream = fs.createWriteStream(
  path.join(logsDir, 'access.log'),
  { flags: 'a' }
);

// –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (–∫–∞–∫ –≤ Apache)
app.use(morgan('combined', { stream: accessLogStream }));
```

–ò –¥–æ–±–∞–≤—å—Ç–µ –≤ `package.json`:
```json
"dependencies": {
  "morgan": "^1.10.0"
}
```

–ó–∞—Ç–µ–º:
```bash
npm install
pm2 restart qr-generator
```

---

## üîç –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –ï—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –Ω–∞—à–µ–ª 0 —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ª–æ–≥–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç HTTP –∑–∞–ø—Ä–æ—Å—ã**
   - PM2 –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –º–æ–≥—É—Ç –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã (–µ—Å–ª–∏ –Ω–µ—Ç middleware)
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–æ–≥–∏ Nginx/Caddy

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤**
   - –°–∫—Ä–∏–ø—Ç –∏—â–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—ã: `GET /r/...`, `"GET /r/...`
   - –ï—Å–ª–∏ —Ñ–æ—Ä–º–∞—Ç –¥—Ä—É–≥–æ–π, –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–∫—Ä–∏–ø—Ç –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª—ã –ª–æ–≥–æ–≤

### –ï—Å–ª–∏ –µ—Å—Ç—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –º–µ–∂–¥—É –ª–æ–≥–∞–º–∏ –∏ –ë–î:

- **–õ–æ–≥–æ–≤ –±–æ–ª—å—à–µ, —á–µ–º –≤ –ë–î** ‚Üí –í–æ–∑–º–æ–∂–Ω—ã –æ—à–∏–±–∫–∏ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤ –ë–î
- **–í –ë–î –±–æ–ª—å—à–µ, —á–µ–º –≤ –ª–æ–≥–∞—Ö** ‚Üí –í–æ–∑–º–æ–∂–Ω—ã –ø—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î –∏–ª–∏ —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
- **–û—à–∏–±–∫–∏ INSERT/UPDATE** ‚Üí –ö—Ä–∏—Ç–∏—á–Ω–æ! –ù—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ (–¥–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)

---

## üìù –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞

```
üîç –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è QR Generator
============================================================

üìÇ –ü–æ–∏—Å–∫ —Ñ–∞–π–ª–æ–≤ –ª–æ–≥–æ–≤...

‚úÖ –ù–∞–π–¥–µ–Ω–æ 3 —Ñ–∞–π–ª(–æ–≤) –ª–æ–≥–æ–≤:

   üìÑ ./logs/out.log (2.45 MB)
   üìÑ ./logs/err.log (0.12 MB)
   üìÑ ./logs/combined.log (2.57 MB)

üìñ –û–±—Ä–∞–±–æ—Ç–∫–∞ –ª–æ–≥–æ–≤...

üìÑ –û–±—Ä–∞–±–æ—Ç–∫–∞: out.log
   ‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Å—Ç—Ä–æ–∫: 45,234

üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ò–ó –õ–û–ì–û–í:
============================================================
–í—Å–µ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –Ω–∞–π–¥–µ–Ω–æ –≤ –ª–æ–≥–∞—Ö: 76
–ü–µ—Ä–∏–æ–¥: 2024-11-10T10:30:00.000Z - 2024-12-08T15:45:00.000Z

üìã –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ QR-–∫–æ–¥–∞–º:
   MyZHN8BXLS: 19
   –∏6H266iLC8: 14
   ...

‚ö†Ô∏è  –û–®–ò–ë–ö–ò –í –õ–û–ì–ê–•:
============================================================
–í—Å–µ–≥–æ –æ—à–∏–±–æ–∫: 2
–û—à–∏–±–æ–∫ –ë–î: 1
  - –û—à–∏–±–∫–∏ INSERT: 1
  - –û—à–∏–±–∫–∏ UPDATE: 0

üìä –°–†–ê–í–ù–ï–ù–ò–ï –° –ë–ê–ó–û–ô –î–ê–ù–ù–´–•:
============================================================
–í—Å–µ–≥–æ QR-–∫–æ–¥–æ–≤ –≤ –ë–î: 6
–°—É–º–º–∞ total_scans –∏–∑ –ë–î: 76
–†–µ–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –≤ scans: 76
–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –∏–∑ –ª–æ–≥–æ–≤: 76

‚úÖ –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ!
```

---

## üõ†Ô∏è –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: "–§–∞–π–ª—ã –ª–æ–≥–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –≥–¥–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –ª–æ–≥–∏ PM2
pm2 info qr-generator

# –ò–ª–∏ –Ω–∞–π–¥–∏—Ç–µ –≤—Å–µ .log —Ñ–∞–π–ª—ã
find /var/www/qr-generator -name "*.log" -type f

# –£–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –≤—Ä—É—á–Ω—É—é
node analyze-logs.js --log-dir=/path/to/logs
```

### –û—à–∏–±–∫–∞: "Permission denied"

```bash
# –î–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ —á—Ç–µ–Ω–∏–µ
sudo chmod +r /var/log/nginx/access.log
# –ò–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –æ—Ç root
sudo node analyze-logs.js
```

### –°–∫—Ä–∏–ø—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ–¥–ª–µ–Ω–Ω–æ

–î–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ (>100MB) —Å–∫—Ä–∏–ø—Ç –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ–ª–≥–æ. –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ - –æ–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ñ–∞–π–ª—ã –ø–æ—Å—Ç—Ä–æ—á–Ω–æ.

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–µ–≤–µ—Ä–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –≤–∞—à–∏—Ö –ª–æ–≥–æ–≤
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ª–æ–≥–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç HTTP –∑–∞–ø—Ä–æ—Å—ã
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏ PM2 –≤—Ä—É—á–Ω—É—é (—Å–º. –≤—ã—à–µ)


<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Генератор динамических QR кодов</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <!-- Левая боковая панель -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i class="fas fa-qrcode"></i>
                <span>QR Generator</span>
            </div>
        </div>
        <nav class="sidebar-nav">
            <a href="#create" class="nav-item active" onclick="showSection('create'); return false;">
                <i class="fas fa-plus-circle"></i>
                <span>Создать QR</span>
            </a>
            <a href="#dashboard" class="nav-item" onclick="showSection('dashboard'); return false;">
                <i class="fas fa-chart-line"></i>
                <span>Дэшборд</span>
            </a>
            <a href="#list" class="nav-item" onclick="showSection('list'); return false;">
                <i class="fas fa-list"></i>
                <span>Все QR коды</span>
            </a>
        </nav>
    </aside>

    <!-- Основной контент -->
    <div class="main-content">
        <!-- Верхняя панель -->
        <header class="top-header">
            <div class="header-left">
                <h1 class="page-title" id="pageTitle">Создать QR код</h1>
            </div>
            <div class="header-right">
                <div class="period-selector" id="periodSelector" style="display: none;">
                    <button class="period-btn active" data-period="today">Сегодня</button>
                    <button class="period-btn" data-period="yesterday">Вчера</button>
                    <button class="period-btn" data-period="week">Неделя</button>
                    <button class="period-btn" data-period="month">Месяц</button>
                    <select id="periodSelect" class="period-dropdown" onchange="handlePeriodGroupChange()">
                        <option value="days">По дням</option>
                        <option value="hours">По часам</option>
                        <option value="weeks">По неделям</option>
                    </select>
                </div>
                <button class="btn-icon" onclick="refreshCurrentSection()" title="Обновить">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </header>

        <div class="container">

        <!-- Форма создания QR кода -->
        <section id="create-section" class="content-section active">
            <div class="card">
                <h2><i class="fas fa-plus-circle"></i> Создать новый QR код</h2>
                <form id="createForm">
                    <div class="form-group">
                        <label for="url">
                            <i class="fas fa-link"></i> Целевой URL *
                        </label>
                        <input 
                            type="url" 
                            id="url" 
                            placeholder="https://example.com" 
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label for="title">
                            <i class="fas fa-heading"></i> Название (опционально)
                        </label>
                        <input 
                            type="text" 
                            id="title" 
                            placeholder="Мой QR код"
                        >
                    </div>

                    <div class="form-group">
                        <label for="description">
                            <i class="fas fa-align-left"></i> Описание (опционально)
                        </label>
                        <textarea 
                            id="description" 
                            rows="3" 
                            placeholder="Краткое описание для чего этот QR код"
                        ></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-magic"></i> Сгенерировать QR код
                    </button>
                </form>
            </div>

            <!-- Результат генерации -->
            <div id="result" class="card result-card" style="display: none;">
                <h3><i class="fas fa-check-circle"></i> QR код успешно создан!</h3>
                <div class="qr-display">
                    <img id="qrImage" src="" alt="QR Code">
                    <div class="qr-info">
                        <div class="info-item">
                            <strong>Короткая ссылка:</strong>
                            <a id="shortUrl" href="" target="_blank"></a>
                            <button class="btn-copy" onclick="copyToClipboard('shortUrl')">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <div class="info-item">
                            <strong>Оригинальный URL:</strong>
                            <span id="originalUrl"></span>
                        </div>
                        <div class="info-item">
                            <strong>Короткий код:</strong>
                            <code id="shortCode"></code>
                        </div>
                    </div>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="downloadQR()">
                        <i class="fas fa-download"></i> Скачать QR код
                    </button>
                    <button class="btn btn-info" onclick="viewStats()">
                        <i class="fas fa-chart-line"></i> Посмотреть статистику
                    </button>
                </div>
            </div>
        </section>

        <!-- Дэшборд аналитики - Диаграмма -->
        <section id="dashboard-section" class="content-section">
            <!-- Карточки метрик -->
            <div class="metrics-cards" id="metricsCards">
                <div class="metric-card">
                    <div class="metric-label">Всего QR кодов</div>
                    <div class="metric-value" id="metricTotalQR">-</div>
                    <div class="metric-change" id="metricTotalQRChange">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Всего переходов</div>
                    <div class="metric-value" id="metricTotalScans">-</div>
                    <div class="metric-change" id="metricTotalScansChange">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Активных QR</div>
                    <div class="metric-value" id="metricActiveQR">-</div>
                    <div class="metric-change" id="metricActiveQRChange">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Среднее за период</div>
                    <div class="metric-value" id="metricAvgScans">-</div>
                    <div class="metric-change" id="metricAvgScansChange">-</div>
                </div>
            </div>
            <div class="card">
                <div class="section-header">
                    <h2><i class="fas fa-chart-line"></i> Хронологические диаграммы переходов</h2>
                    <button class="btn btn-secondary btn-sm" onclick="loadDashboard()">
                        <i class="fas fa-sync-alt"></i> Обновить
                    </button>
                </div>
                
                <!-- График -->
                <div id="dashboardContent" class="dashboard-content">
                    <div class="dashboard-placeholder">
                        <i class="fas fa-chart-area"></i>
                        <p>Выберите один или несколько QR кодов для отображения на диаграмме</p>
                    </div>
                </div>
                
                <!-- Выбор QR кодов для отображения (под графиком) -->
                <div class="dashboard-qr-selector">
                    <div class="qr-selector-header">
                        <label>
                            <i class="fas fa-qrcode"></i> Выберите QR коды для сравнения:
                        </label>
                    </div>
                    <div id="qrCodesCheckboxes" class="qr-codes-checkboxes-compact">
                        <div class="loading">
                            <i class="fas fa-spinner fa-spin"></i> Загрузка QR кодов...
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Список QR кодов -->
        <section id="list-section" class="content-section">
            <div class="card">
                <div class="section-header">
                    <h2><i class="fas fa-list"></i> Все QR коды</h2>
                    <button class="btn btn-secondary btn-sm" onclick="loadQRList()">
                        <i class="fas fa-sync-alt"></i> Обновить
                    </button>
                </div>
                <div id="qrList" class="qr-list">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i> Загрузка...
                    </div>
                </div>
            </div>
        </section>

        <!-- Модальное окно статистики -->
        <div id="statsModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2><i class="fas fa-chart-bar"></i> Статистика переходов</h2>
                    <button class="close-btn" onclick="closeStatsModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body" id="statsContent">
                    <!-- Контент будет загружен динамически -->
                </div>
            </div>
        </div>
    </div>

        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>

